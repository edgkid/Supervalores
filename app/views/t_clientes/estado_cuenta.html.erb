<div class="row">
  <div class="col-5">
    <div class="card">
      <div class="card-body">
        <h3 class="card-title">Datos del Cliente</h3>
        <%= render 't_facturas/search_client' %>
        <br>
        <div id="client-container">
          <%= render 't_facturas/cliente' %>
        </div>
      </div>
    </div>
  </div>
  <div class="col-12">
    <div class="ibox">
      <div class="ibox-title">
        <div class="row">
          <h3 class="col-sm-6">Facturas Registradas</h3>

          <div class="col-sm-2 col-form-label">
            <label>Estatus:</label>
          </div>
          <div class="col-sm-3 input-value">
            <%= select_tag :t_estatus_id, options_for_select(opciones_de_estatus(true, 1, true), nil), { id:"select-estatus", :class => 'form-control m-b' } %>
          </div>
          <div class="col-sm-1 input-value">
            <button id="btn-refresh-table" class="btn btn-default"><i class="fa fa-refresh"></i></button>
          </div>
        </div>
      </div>
      <div class="ibox-content">
        <div class="table-responsive">
          <table class="table table-striped table-bordered table-hover dataTables clickable"
            data-source="<%= estados_de_cuenta_path(format: :json) %>" id="ajax-datatable">
            <thead>
              <tr>
                <th>NÂ°</th>
                <th>Fecha</th>
                <th>F. Venc</th>
                <th>Recargo</th>
                <th>Total</th>
                <th>Pendiente</th>
                <th>Tp</th>
                <!-- <th>Prosp.</th> -->
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  <%= render partial: "t_facturas/script.js" %>

    $.extend({
      useDataInAjaxCall: function (d) {
        d.t_estatus_id = $('#select-estatus').val();
        d.t_resolucion_id = $('#select-resolucion').val();
      },
      useDataTableFooter: function (footer) {
        $.ajax({
          url: "<%= calculo_de_totales_path %>",
          data: {
            t_estatus_id: $('#select-estatus').val(),
            t_resolucion_id: $('#select-resolucion').val()
          }
        })
          .done(function (data) {
            console.log(data)
            if (data.procesado) {
              footer.empty().append($("<tr />")
                .append($("<td />"))
                .append($("<td />"))
                .append($("<td />"))
                .append($("<td />").html("Total"))
                .append($("<td />").html(data.total))
                .append($("<td />").html(data.por_pagar))
                .append($("<td />"))
              )
            }
          });
      }
    });

  refreshTable = function () {
    $("#ajax-datatable").DataTable().ajax.reload();
  }

  $('#select-estatus').change(refreshTable)
  $("#btn-refresh-table").click(refreshTable)
  $('#select-resolucion').change(refreshTable)
</script>